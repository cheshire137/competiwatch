<% content_for(:title, "#{@oauth_account} Profile") %>

<div class="clearfix">
  <div class="col-md-6 float-left">
    <%= render partial: 'oauth_accounts/summary',
               locals: { profile: @profile, stats: @stats, oauth_account: @oauth_account } %>
    <div class="mb-4 pb-2">
      <%= render partial: 'oauth_accounts/stats', locals: { stats: @stats } %>
    </div>
  </div>
  <div class="col-md-4 float-left">
    <h2 class="h2 text-normal mt-0 mb-2">Competitive seasons</h2>
    <ul class="list-style-none">
      <% if @match_count_by_season.empty? %>
        <li class="text-gray text-italic">
          <% if @is_owner %>
            No matches logged for <%= @oauth_account %>
          <% else %>
            <%= @oauth_account %> has not shared any seasons
          <% end %>
        </li>
      <% end %>
      <% @match_count_by_season.each do |season, match_count| %>
        <li class="mb-2">
          <a href="<%= matches_path(season, @oauth_account) %>">
            <% if @is_owner && @season_shares_by_season.size != @match_count_by_season.size %>
              <% if @season_shares_by_season.key?(season) %>
                <span class="mr-1 d-inline-block placeholder-icon"></span>
              <% else %>
                <span class="tooltipped tooltipped-w" aria-label="Only visible to you">
                  <span class="text-gray text-small ion ion-locked mr-1 d-inline-block"></span>
                </span>
              <% end %>
            <% end %>
            Season <%= season %>
            <span class="text-gray text-small d-inline-block ml-2">
              <%= number_with_delimiter match_count %>
              <%= 'match'.pluralize(match_count) %>
            </span>
          </a>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<% if @is_owner %>
  <div class="clearfix mb-4 border-top pt-4">
    <% if @other_oauth_accounts.size > 1 %>
      <div class="col-md-3 float-left">
        <h2 class="h4 mb-2 mt-0">Your other accounts</h2>
        <ul class="list-style-none">
          <% @other_oauth_accounts.each do |oauth_account| %>
            <li>
              <a href="<%= profile_path(oauth_account) %>">
                <%= oauth_account %>
              </a>
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
    <div class="col-md-3 float-left">
      <%= form_for(@oauth_account, url: profile_path(@oauth_account), method: :put) do |f| %>
        <h2 class="h4 my-0">Account settings</h2>
        <div class="d-flex-md flex-items-end">
          <div class="form-group mb-0 mr-4 d-flex flex-items-center">
            <%= f.label :platform, 'Platform:', class: 'mr-2' %>
            <%= f.select :platform, options_for_select(platform_options, @oauth_account.platform), {}, { class: 'form-select' } %>
          </div>
          <div class="form-group mb-0 mr-4 d-flex flex-items-center">
            <%= f.label :region, 'Region:', class: 'mr-2' %>
            <%= f.select :region, options_for_select(region_options, @oauth_account.region), {}, { class: 'form-select' } %>
          </div>
          <button type="submit" class="btn">Save</button>
        </div>
      <% end %>
    </div>
  </div>
<% end %>

<p class="mt-4 border-top pt-4">
  <a class="d-inline-block mr-4" href="<%= @oauth_account.overbuff_url %>" target="_blank" rel="noopener noreferrer">
    <span class="ion ion-link text-gray mr-1"></span>
    Overbuff profile
  </a>
  <a class="d-inline-block mr-4" href="<%= @oauth_account.master_overwatch_url %>" target="_blank" rel="noopener noreferrer">
    <span class="ion ion-link text-gray mr-1"></span>
    Master Overwatch profile
  </a>
  <a href="<%= @oauth_account.play_overwatch_url %>" target="_blank" rel="noopener noreferrer">
    <span class="ion ion-link text-gray mr-1"></span>
    PlayOverwatch profile
  </a>
</p>
